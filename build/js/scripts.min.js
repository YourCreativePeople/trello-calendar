function getWeeks(){for(var e=moment(),r=moment(e).isoWeekday(1),o=r,a=2,t=new Array,l=0;a>l;l++){var n=new Object;n.WeekNumber=o.isoWeek();for(var d=new Array,s=0;5>s;s++){var i=new Object;i.TheDate=o,d.push(i),n.Days=d,o=moment(o).add("days",1)}t.push(n),o=moment(o).add("days",2)}trelloCards.set({weeks:t}),console.log(t)}function processMemberCards(e,r){console.log(r);new Array,new Array}var orgData,trelloCards=new Ractive({el:"container",template:"#template",data:{org:orgData,tempFunction:function(){},getBoard:function(e){return""!==trelloCards.data.org.boards[e].name?trelloCards.data.org.boards[e].name:"Board in another org"},formatDate:function(e){return e.format("DD - MMM")}}});trelloCards.on({change:function(){}}),trelloCards.observe("org",function(){trelloCards.data.org&&(localStorage.trelloCalendar=JSON.stringify(trelloCards.data.org))}),trelloCards.observe("org.boards",function(){trelloCards.data.org&&(localStorage.trelloCalendar=JSON.stringify(trelloCards.data.org))});var onAuthorize=function(){updateLoggedIn(),Trello.get("organizations/ycp",{fields:"displayName,url",boards:"open",board_fields:"name,desc,shortUrl",members:"all",member_fields:"username,fullName"},function(e){var r=e.boards,o={};delete e.boards,e.boards={};for(var a=0;a<r.length;a++)o[r[a].id]=r[a],delete o[r[a].id].id;e.boards=o,getWeeks(),$.each(e.members,function(r,o){o.cards=new Array,Trello.get("members/"+o.id+"/cards",{fields:"name,url,due,desc,idBoard"},function(r){for(var a=r.length-1;a>=0;a--)null===r[a].due?r.splice(a,1):r[a].due=new Date(r[a].due);o.cards=r,processMemberCards(o,r),trelloCards.set({org:e})})}),trelloCards.update()})},updateLoggedIn=function(){Trello.members.get("me",function(e){$("#fullName").text(e.fullName)});var e=Trello.authorized();$(".loggedout").toggle(!e),$(".loggedin").toggle(e)},logout=function(){Trello.deauthorize(),updateLoggedIn()};Trello.authorize({interactive:!1,success:onAuthorize}),$("#connectLink").click(function(){Trello.authorize({type:"popup",success:onAuthorize})}),Date.prototype.getWeekNumber=function(){var e=new Date(+this);return e.setHours(0,0,0),e.setDate(e.getDate()+4-(e.getDay()||7)),Math.ceil(((e-new Date(e.getFullYear(),0,1))/864e5+1)/7)},$("#disconnect").click(logout);